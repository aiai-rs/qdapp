<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <meta name="theme-color" content="#17212b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ±‡ç›ˆå›½é™…å®˜æ–¹å®¢æœ</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        tg: { bg: "#0f1621", header: "#17212b", input: "#0e1621", blue: "#2b5278", secondary: "#182533", accent: "#0088cc", danger: "#ff5252", warning: "#fb8c00", info: "#8774e1" },
                        login: { bg: "#0b1016", card: "#161d27", input: "#161e29", textMain: "#ffffff", textSub: "#3b82f6", textWarn: "#ef4444", textErr: "#ff4b4b" }
                    },
                    animation: { 'slide-up': 'slideUp 0.3s ease-out forwards', 'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both', 'fade-in': 'fadeIn 0.3s forwards' },
                    keyframes: { 
                        slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }, 
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } }, 
                        fadeIn: { from: {opacity:0}, to:{opacity:1} } 
                    }
                }
            }
        }
    </script>
    <style>
        html, body { height: 100%; overflow: hidden; overscroll-behavior: none; background-color: #0f1621; }
        body { color: white; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-user-select: none; user-select: none; }
        #root { height: 100dvh; display: flex; flex-direction: column; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .bg-pattern { background-image: url('https://web.telegram.org/img/bg_0.png'); background-repeat: repeat; background-attachment: fixed; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .ios-scroll { -webkit-overflow-scrolling: touch; overflow-y: auto; overscroll-behavior-y: contain; }
        .glass-btn { background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%); box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
        .glass-btn:active { transform: scale(0.98); }
    </style>
</head>
<body oncontextmenu="return false">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const SOCKET_URL = "https://lt-1li6.onrender.com"; 
        
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) { outputArray[i] = rawData.charCodeAt(i); }
            return outputArray;
        }

        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        let w = img.width, h = img.height;
                        const maxSide = 1280; 
                        if (Math.max(w, h) > maxSide) { const scale = maxSide / Math.max(w, h); w *= scale; h *= scale; }
                        canvas.width = w; canvas.height = h;
                        ctx.drawImage(img, 0, 0, w, h);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                };
            });
        };

        const IconStatus = ({ status }) => status === 'read' ? <span className="text-green-400 text-[10px] ml-1 font-bold">âœ“âœ“</span> : <span className="text-gray-400 text-[10px] ml-1">âœ“</span>;
        
        const getWorkStatus = () => {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const cambodiaTime = new Date(utc + (3600000 * 7));
            const hour = cambodiaTime.getHours();
            const isWorking = hour >= 13 && hour < 23; 
            return { isWorking, text: isWorking ? 'å½“å‰ä¸šåŠ¡å‘˜ç¹å¿™' : 'ä¼‘æ¯ä¸­ (è¯·ç•™è¨€)', color: isWorking ? 'text-green-400' : 'text-tg-warning' };
        };

        function App() {
            const [step, setStep] = useState('loading'); 
            const [loginInput, setLoginInput] = useState('');
            const [userId, setUserId] = useState('');
            const [bossId, setBossId] = useState('');
            const [messages, setMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [showTutorial, setShowTutorial] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');
            const [isShake, setIsShake] = useState(false);
            const [workStatus, setWorkStatus] = useState(getWorkStatus());
            const [previewImg, setPreviewImg] = useState(null);
            const [adminTyping, setAdminTyping] = useState(false);
            
            // PWA å®‰è£…ç›¸å…³
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            
            const socketRef = useRef(null);
            const scrollRef = useRef(null);
            const typingTimeoutRef = useRef(null);
            const titleIntervalRef = useRef(null);

            // --- PWA: Service Worker & Install ---
            useEffect(() => {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW Fail', err));
                }
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e); 
                });
                const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
                const isInStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
                if (isIos && !isInStandalone) setShowInstallPrompt(true); 
            }, []);

            const handleInstallClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') setDeferredPrompt(null);
                    });
                }
            };

            const registerPush = async (uid) => {
                if (!('serviceWorker' in navigator) || !('PushManager' in window)) return;
                try {
                    const registration = await navigator.serviceWorker.ready;
                    let sub = await registration.pushManager.getSubscription();
                    if (!sub) {
                        const res = await fetch(`${SOCKET_URL}/api/vapid-key`);
                        const { publicKey } = await res.json();
                        if(!publicKey) return; 
                        sub = await registration.pushManager.subscribe({
                            userVisibleOnly: true,
                            applicationServerKey: urlBase64ToUint8Array(publicKey)
                        });
                    }
                    await fetch(`${SOCKET_URL}/api/subscribe`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ userId: uid, subscription: sub })
                    });
                    console.log('Push Registered');
                } catch (e) { console.log('Push Error', e); }
            };
            // ----------------------------------------

            useEffect(() => {
                const requestNotify = () => {
                    if("Notification" in window && Notification.permission !== "granted") Notification.requestPermission();
                };
                const unlockAudio = () => {
                    const a = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABBlYXRhAgAAAAEA");
                    a.play().catch(()=>{});
                    requestNotify();
                    if(userId) registerPush(userId);
                };
                document.body.addEventListener('click', unlockAudio, { once: true });
                document.body.addEventListener('touchstart', unlockAudio, { once: true });
                
                const timer = setInterval(() => setWorkStatus(getWorkStatus()), 60000);
                return () => clearInterval(timer);
            }, [userId]);

            const flashTitle = (start) => {
                if (titleIntervalRef.current) clearInterval(titleIntervalRef.current);
                if (start) {
                    let isNew = true;
                    titleIntervalRef.current = setInterval(() => { document.title = isNew ? "ã€æ–°æ¶ˆæ¯ã€‘æ±‡ç›ˆå›½é™…å®˜æ–¹å®¢æœ" : "æ±‡ç›ˆå›½é™…ä¸šåŠ¡å‘˜"; isNew = !isNew; }, 1000);
                } else { document.title = "æ±‡ç›ˆå›½é™…å®˜æ–¹å®¢æœ"; }
            };

            useEffect(() => {
                const handleVisibility = () => {
                    if (document.visibilityState === 'visible') {
                        flashTitle(false);
                        const u = localStorage.getItem('hy_uid');
                        if(socketRef.current?.connected === false) socketRef.current.connect();
                        if(u) fetchMessages(u);
                        if(socketRef.current && u) socketRef.current.emit('mark_read', { userId: u, isAdmin: false });
                        if(u) registerPush(u); 
                    }
                };
                document.addEventListener('visibilitychange', handleVisibility);
                const u = localStorage.getItem('hy_uid');
                const b = localStorage.getItem('hy_boss');
                if(u && b) doLogin(u, b); else setStep('login');
                return () => document.removeEventListener('visibilitychange', handleVisibility);
            }, []);

            useEffect(() => scrollRef.current?.scrollIntoView({ behavior: "smooth" }), [messages, adminTyping]);

            const notify = () => { try { const audio = new Audio("data:audio/mp3;base64,SUQzBAAAAAABAFRYWFgAAAASAAADbWFqb3JfYnJhbmQAbXA0MgBUWFhYAAAAEQAAA21pbm9yX3ZlcnNpb24AMABUWFhYAAAAHAAAA2NvbXBhdGlibGVfYnJhbmRzAGlzb21tcDQyAFRTU0UAAAAPAAADTGF2ZjU3LjgzLjEwMAAAAAAAAAAAAAAA//uQZAAAAAAAABAAAAAAAAAAAAkJAAAgAAAABBjatLUkAAALiI1yUIAAAAAA//uQZAAABHpWUNzgAAIE6sobnAAACW1lS+w8AAiVrKl9h4AAAD/8z/8///4v/9P/8v8Z///4iH/////5MAAiAAACAAAAABAA8AAAAA//uQZAEABdZRVH5gAAl1lKU/mAAAggVlS+w8AAhxrKl9h4AAAAv///4DAAEAJgAOAFAAbAB8AIAAxADoAPABSAHAAgACWAKgArAC8AMQA0gDeAOwA+gEIAQwBGgEgASgBLAEyAToBQAFIAT4BRAFQAVgBXAFkAWgBcAF4AYABiAGMAZgBoAGoAbABuAHAAcgB0AHYAxQD9AP8BAQEDAv///wAAAAAA"); audio.play().catch(()=>{}); if("vibrate" in navigator) navigator.vibrate([200, 100, 200]); } catch(e){} if (document.hidden) flashTitle(true); };
            const fetchMessages = (uid) => { fetch(`${SOCKET_URL}/api/history/${uid}`).then(r=>r.json()).then(d => { if(Array.isArray(d)) setMessages(d); }); };
            const doLogin = (uid, bid) => { setUserId(uid); setBossId(bid); setStep('chat'); initSocket(uid, bid); registerPush(uid); };

            const initSocket = (uid, bid) => {
                if (socketRef.current) return;
                try {
                    socketRef.current = io(SOCKET_URL);
                    socketRef.current.on('connect', () => socketRef.current.emit('join', { userId: uid, bossId: bid }));
                    socketRef.current.on('receive_message', (msg) => {
                        setMessages(prev => { if (prev.some(m => m.id === msg.id)) return prev; return [...prev, msg]; });
                        if(!msg.isFromUser) { notify(); setAdminTyping(false); if (document.visibilityState === 'visible') socketRef.current.emit('mark_read', { userId: uid, isAdmin: false }); }
                    });
                    socketRef.current.on('message_deleted', ({ messageId }) => setMessages(prev => prev.filter(m => m.id !== messageId)));
                    socketRef.current.on('display_typing', ({ isTyping }) => { setAdminTyping(isTyping); if(typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current); if(isTyping) typingTimeoutRef.current = setTimeout(()=>setAdminTyping(false), 3000); });
                    socketRef.current.on('messages_read_update', () => setMessages(prev => prev.map(m => m.isFromUser ? { ...m, status: 'read' } : m)));
                    socketRef.current.on('force_logout', () => { localStorage.clear(); location.reload(); });
                    socketRef.current.on('force_logout_blocked', () => { localStorage.clear(); document.body.innerHTML = `<div style="display:flex;height:100vh;justify-content:center;align-items:center;background:#0f1621;color:#ff5252;font-weight:bold;">ğŸš« è®¿é—®è¢«æ‹’ç»</div>`; socketRef.current.disconnect(); });
                    fetchMessages(uid);
                } catch (e) {}
            };

            const handleLoginBtn = () => { if("Notification" in window) Notification.requestPermission(); setErrorMsg(''); const input = loginInput.trim().toLowerCase().replace(/@/g, ''); const validBosses = ['rrii8', 'iibb8']; if (validBosses.includes(input)) { const finalBossId = '@' + input; const tempSocket = io(SOCKET_URL); tempSocket.emit('request_id', finalBossId, (newId) => { localStorage.setItem('hy_uid', newId); localStorage.setItem('hy_boss', finalBossId); tempSocket.disconnect(); doLogin(newId, finalBossId); }); } else { setErrorMsg(''); setTimeout(() => { setErrorMsg('æœªæ‰¾åˆ°è¯¥è€æ¿ç”¨æˆ·å'); setIsShake(true); setTimeout(() => setIsShake(false), 400); }, 10); } };
            const handleTyping = (e) => { setChatInput(e.target.value); socketRef.current.emit('typing', { targetId: 'admin', isTyping: true }); if(typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current); typingTimeoutRef.current = setTimeout(() => { socketRef.current.emit('typing', { targetId: 'admin', isTyping: false }); }, 2000); };
            const handleSend = () => { if (!chatInput.trim()) return; const msgData = { userId, bossId, content: chatInput, type: 'text', isFromUser: true, createdAt: new Date(), status: 'sent' }; setMessages(prev => [...prev, msgData]); socketRef.current.emit('send_message', msgData); socketRef.current.emit('typing', { targetId: 'admin', isTyping: false }); setChatInput(''); };
            const handleImageUpload = async (e) => { const file = e.target.files[0]; if (!file) return; try { const compressedBase64 = await compressImage(file); const msgData = { userId, bossId, content: compressedBase64, type: 'image', isFromUser: true, createdAt: new Date(), status: 'sent' }; setMessages(prev => [...prev, msgData]); socketRef.current.emit('send_message', msgData); } catch(e) { alert("å›¾ç‰‡å¤„ç†å¤±è´¥"); } e.target.value = ''; };

            if (step === 'loading') return <div className="h-[100dvh] flex items-center justify-center bg-tg-bg text-white font-bold text-xl">æ±‡ç›ˆå›½é™…å®˜æ–¹ä¸šåŠ¡å‘˜</div>;

            if (step === 'login') return (
                <div className="h-[100dvh] w-full bg-login-bg flex flex-col justify-center px-8 relative font-sans">
                    <div className="z-10 w-full max-w-[340px] mx-auto">
                        <h1 className="text-[34px] font-black text-white mb-2">æ±‡ç›ˆå›½é™…å®˜æ–¹å®¢æœ</h1>
                        <p className="text-gray-400 text-[15px] mb-8 font-medium">è¯·è¾“å…¥å¹¿å‘Šä¸­è€æ¿çš„ <span className="text-login-textSub font-bold">Telegram ç”¨æˆ·å</span></p>
                        <div className="mb-6 flex items-start gap-2.5"><span className="text-yellow-500 text-sm mt-0.5">âš ï¸</span><span className="text-login-textWarn text-[13px] font-bold">è€æ¿ä»…ç”¨ Telegramï¼Œè¯·åŠ¡å¿…è”ç³»ä¸šåŠ¡å‘˜</span></div>
                        <div className="space-y-6">
                            <div className="relative group"><div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><span className="text-gray-500 font-bold text-lg select-none">@</span></div><input type="text" value={loginInput} onChange={(e) => setLoginInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleLoginBtn()} className="w-full bg-login-input border border-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600/50 rounded-xl py-4 pl-10 pr-4 text-white outline-none transition-all placeholder-gray-500 text-[16px] shadow-sm font-medium" placeholder="è¾“å…¥å¹¿å‘Šä¸­è€æ¿çš„TGç”¨æˆ·å" /></div>
                            <div className="min-h-[24px]">{errorMsg && (<div className={`text-login-textErr text-[13px] font-bold flex items-center gap-1.5 ${isShake ? 'animate-shake' : ''}`}>{errorMsg}</div>)}</div>
                            <button onClick={handleLoginBtn} className="w-full glass-btn text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-all text-[16px]">è¿æ¥æ±‡ç›ˆå›½é™…å®˜æ–¹ä¸šåŠ¡å‘˜ <span className="text-xl leading-none ml-1">â†’</span></button>
                            {deferredPrompt && <button onClick={handleInstallClick} className="w-full bg-white/10 text-white py-2 rounded-xl text-sm font-bold border border-white/20 mt-2">ğŸ“² å®‰è£… App åˆ°æ¡Œé¢ (æ¨è)</button>}
                        </div>
                    </div>
                    {showInstallPrompt && (
                        <div className="fixed bottom-6 left-4 right-4 bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-2xl z-50 text-center animate-slide-up">
                            <p className="text-white text-sm font-bold mb-2">ğŸ“² å®‰è£… App ä»¥æ¥æ”¶ç¦»çº¿æ¶ˆæ¯</p>
                            <p className="text-gray-300 text-xs mb-3">ç‚¹å‡»æµè§ˆå™¨åº•éƒ¨ <svg className="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg> åˆ†äº«æŒ‰é’®<br/>ç„¶åé€‰æ‹© "æ·»åŠ åˆ°ä¸»å±å¹•"</p>
                            <button onClick={() => setShowInstallPrompt(false)} className="text-blue-400 text-xs font-bold">æˆ‘çŸ¥é“äº†</button>
                        </div>
                    )}
                </div>
            );

            return (
                <div className="h-[100dvh] flex flex-col bg-tg-bg max-w-md mx-auto shadow-2xl relative">
                    <header className="h-14 bg-tg-header flex items-center justify-between px-4 shadow-lg z-20 border-b border-white/5 shrink-0 pt-safe">
                        <div className="flex items-center gap-3">
                            <div className="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-sm">HY</div>
                            <div><h3 className="font-bold text-sm text-white">æ±‡ç›ˆå›½é™…å®˜æ–¹å®¢æœ</h3><p className={`text-[10px] ${workStatus.color}`}>{workStatus.text}</p></div>
                        </div>
                        <div className="flex gap-2">
                            {deferredPrompt && <button onClick={handleInstallClick} className="bg-blue-600 text-white text-xs px-3 py-1.5 rounded-full">ğŸ“² å®‰è£…</button>}
                            <button onClick={() => setShowTutorial(true)} className="bg-white/5 hover:bg-white/10 text-tg-accent text-xs px-3 py-1.5 rounded-full border border-tg-accent/30">æ•™ç¨‹</button>
                        </div>
                    </header>
                    <div className="flex-1 ios-scroll p-4 space-y-3 bg-pattern">
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.isFromUser ? 'justify-end' : 'justify-start'} animate-slide-up`}>
                                <div className={`px-3 py-2.5 rounded-2xl text-sm shadow-sm relative break-words ${msg.isFromUser ? 'bg-tg-blue text-white rounded-tr-sm' : 'bg-tg-secondary text-white rounded-tl-sm'}`}>
                                    {(msg.type === 'image' || msg.content.startsWith('data:image')) ? <img src={msg.content} className="max-w-[200px] rounded-lg" onClick={() => setPreviewImg(msg.content)} /> : <p className="whitespace-pre-wrap leading-relaxed max-w-[260px]">{msg.content}</p>}
                                    <div className="flex justify-end items-center gap-1 mt-1"><span className="text-[10px] opacity-50">{new Date(msg.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>{msg.isFromUser && <IconStatus status={msg.status} />}</div>
                                </div>
                            </div>
                        ))}
                        {adminTyping && <div className="bg-tg-secondary px-3 py-2 rounded-xl w-12 flex gap-1 ml-1 mb-2"><div className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"></div><div className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style={{animationDelay:'0.1s'}}></div><div className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style={{animationDelay:'0.2s'}}></div></div>}
                        <div ref={scrollRef} />
                    </div>
                    <div className="bg-tg-header p-3 pb-safe border-t border-white/5 shrink-0 flex gap-2 items-end">
                        <label className="p-2 text-gray-400"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><input type="file" accept="image/*" className="hidden" onChange={handleImageUpload} /></label>
                        <textarea rows="1" value={chatInput} onChange={handleTyping} onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())} className="flex-1 bg-transparent text-white text-sm p-2 outline-none" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>
                        <button onClick={handleSend} disabled={!chatInput.trim()} className="p-2 rounded-xl text-white bg-tg-accent shadow-lg"><svg className="w-5 h-5 rotate-90" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg></button>
                    </div>
                    {previewImg && <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-md" onClick={() => setPreviewImg(null)}><img src={previewImg} className="max-w-screen max-h-screen object-contain" /></div>}
                    {showTutorial && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm px-6" onClick={() => setShowTutorial(false)}>
                            <div className="w-full max-w-sm bg-tg-header rounded-2xl border border-gray-700 overflow-hidden shadow-2xl p-5" onClick={e => e.stopPropagation()}>
                                <h3 className="font-bold text-white mb-4">ğŸš€ å¿«é€Ÿæ•™ç¨‹</h3>
                                <p className="text-gray-300 text-sm mb-4">1. è·å–ç¾åŒº Apple IDï¼ˆè”ç³»ä¸šåŠ¡å‘˜è·å–ï¼‰<br/>2. ä¸‹è½½ Shadowrocketï¼ˆè”ç³»ä¸šåŠ¡å‘˜è·å–ï¼‰<br/>3. å¤åˆ¶é“¾æ¥æ‰“å¼€ï¼ˆè”ç³»ä¸šåŠ¡å‘˜è·å–ï¼‰</p>
                                <button onClick={() => setShowTutorial(false)} className="w-full bg-tg-accent text-white py-2 rounded">å…³é—­</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>